: ${bt:=/data/school/06_BT}

rnas_pkgs=("" -cli -web -worker)
rnas_pkgs=("${rnas_pkgs[@]/#/rna-seqlyze}")

rnas_topdir=$bt
rnas_pkgdirs=("${rnas_pkgs[@]/#/$rnas_topdir/src/}")

if [ "$PS1" ]
then
	dirs -c
	for ((i=${#rnas_pkgdirs[@]}-1; i>=0; i--))
	do
		pushd "${rnas_pkgdirs[i]}"
	done
	pushd "$rnas_topdir"
	cd ~1
fi

buildbot ()
(
	set -e
	cd ~/buildbot-virtualenv
	. bin/activate
	command buildbot $1 buildmaster
	command buildslave $1 buildslave
)

sig-int ()
{
	curl localhost/biopython/debug?{sig_int,sig_int}
}

py-redevelop ()
{
	for dir in "${rnas_pkgdirs[@]}"
	do (
		cd "$dir"
		python setup.py develop --user
	) done

	sig-int

	# compute test coverage
	#  --cover-inclusive: include modules not loaded by test scripts
	#  --cover-package: restrict coverage report to packge
	#  --cover-html: generate html coverage report
	(
		cd "$rnas_topdir"
		nosetests --with-coverage		\
			--cover-inclusive		\
			--cover-package rnaseqlyze	\
			--cover-html --cover-html-dir=report/coverage "${rnas_pkgdirs[@]}"
		rm -f .coverage
	)
}
